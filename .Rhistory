(PINCP > 80001 & PINCP <= 100000),
"$80,001 to $100,000",
income
),
income = ifelse(
(PINCP > 100001 & PINCP <= 150000),
"$100,001 to $150,000",
income
),
income = ifelse(
(PINCP > 150001 & PINCP <= 200000),
"$150,001 to $200,000",
income
),
income = ifelse(
(PINCP > 200001 & PINCP <= 250000),
"$200,001 to $250,000",
income
),
income = ifelse(
(PINCP > 250001),
"$250,001 or more",
income
),
RAC1P = as.numeric(RAC1P)
) %>%
filter(
(RAC1P %in% 6)) #Asian American alone
ca_pums_IRC <-
cleaned %>%
mutate(
PWGTP = as.numeric(PWGTP),
PINCP = as.numeric(PINCP),
Same_sex_household = ifelse(
(CPLT == 2)|(CPLT == 4),
"Same sex couple",
"Opposite sex couple"
),
income =  ifelse(
(PINCP <= 20000),
"$20,000 or less",
PINCP
),
income = ifelse(
(PINCP > 20001 & PINCP <= 50000),
"$20,001 to $50,000",
income
),
income = ifelse(
(PINCP > 50001 & PINCP <= 80000),
"$50,001 to $80,000",
income
),
income = ifelse(
(PINCP > 80001 & PINCP <= 100000),
"$80,001 to $100,000",
income
),
income = ifelse(
(PINCP > 100001 & PINCP <= 150000),
"$100,001 to $150,000",
income
),
income = ifelse(
(PINCP > 150001 & PINCP <= 200000),
"$150,001 to $200,000",
income
),
income = ifelse(
(PINCP > 200001 & PINCP <= 250000),
"$200,001 to $250,000",
income
),
income = ifelse(
(PINCP > 250001),
"$250,001 or more",
income
),
RAC1P = as.numeric(RAC1P)
) %>%
filter(
(RAC1P %in% 3)) #American Indian alone
ca_pums_income_same <-
cleaned %>%
filter(
(RAC1P %in% c(1,2,3,6,9)),
(RAC1P %in% 3)) %>% #American Indian alone
mutate(
PWGTP = as.numeric(PWGTP),
PINCP = as.numeric(PINCP),
income =  ifelse(
((CPLT == 2)|(CPLT == 4)) & (PINCP <= 50000),
1,
0),
same_sex = ifelse(
(CPLT == 2)|(CPLT == 4),
1,
0
)) %>%
group_by(PUMA) %>%
summarize(
income = sum(income, na.rm = T),
same_sex_pop = sum(same_sex, na.rm = T)
) %>%
mutate(
percent = income/same_sex_pop*100
) %>%
left_join(
ca_pumas %>%
select(PUMACE10),
by = c("PUMA" = "PUMACE10")
) %>%
st_as_sf()
ca_pums_IRC <-
cleaned %>%
mutate(
PWGTP = as.numeric(PWGTP),
PINCP = as.numeric(PINCP),
Same_sex_household = ifelse(
(CPLT == 2)|(CPLT == 4),
"Same sex couple",
"Opposite sex couple"
),
income =  ifelse(
(PINCP <= 20000),
"$20,000 or less",
PINCP
),
income = ifelse(
(PINCP > 20001 & PINCP <= 50000),
"$20,001 to $50,000",
income
),
income = ifelse(
(PINCP > 50001 & PINCP <= 80000),
"$50,001 to $80,000",
income
),
income = ifelse(
(PINCP > 80001 & PINCP <= 100000),
"$80,001 to $100,000",
income
),
income = ifelse(
(PINCP > 100001 & PINCP <= 150000),
"$100,001 to $150,000",
income
),
income = ifelse(
(PINCP > 150001 & PINCP <= 200000),
"$150,001 to $200,000",
income
),
income = ifelse(
(PINCP > 200001 & PINCP <= 250000),
"$200,001 to $250,000",
income
),
income = ifelse(
(PINCP > 250001),
"$250,001 or more",
income
),
RAC1P = as.numeric(RAC1P)
) %>%
filter(
(RAC1P %in% 9)) #Two or More Races
ca_two_total <-
ca_pums_IRC %>%
group_by(Same_sex_household) %>%
summarize(estimate = sum(PWGTP)) %>%
mutate(income = "Total")
ca_pums_IRC %>%
group_by(income, Same_sex_household) %>%
summarize(estimate = sum(PWGTP)) %>%
rbind(ca_two_total) %>%
ggplot() +
geom_bar(
aes(
x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
y = estimate,
fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Household income",
y = "Number of households",
title = "California household income by couple type",
fill = "Couple Type"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
ca_pums_IRC <-
cleaned %>%
filter(
(CPLT %in% c(2, 4)) #Filtering out opposite-sex couples
) %>%
mutate(
PWGTP = as.numeric(PWGTP),
PINCP = as.numeric(PINCP),
income =  ifelse(
(PINCP <= 20000),
"$20,000 or less",
PINCP
),
income = ifelse(
(PINCP > 20001 & PINCP <= 50000),
"$20,001 to $50,000",
income
),
income = ifelse(
(PINCP > 50001 & PINCP <= 80000),
"$50,001 to $80,000",
income
),
income = ifelse(
(PINCP > 80001 & PINCP <= 100000),
"$80,001 to $100,000",
income
),
income = ifelse(
(PINCP > 100001 & PINCP <= 150000),
"$100,001 to $150,000",
income
),
income = ifelse(
(PINCP > 150001 & PINCP <= 200000),
"$150,001 to $200,000",
income
),
income = ifelse(
(PINCP > 200001 & PINCP <= 250000),
"$200,001 to $250,000",
income
),
income = ifelse(
(PINCP > 250001),
"$250,001 or more",
income
),
Sex = ifelse(
(SEX == 1),
"Male",
"Female"
))
ca_sex_total <-
ca_pums_IRC %>%
group_by(Sex) %>%
summarize(estimate = sum(PWGTP)) %>%
mutate(income = "Total")
ca_pums_IRC %>%
group_by(income, Sex) %>%
summarize(estimate = sum(PWGTP)) %>%
rbind(ca_sex_total) %>%
ggplot() +
geom_bar(
aes(
x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
y = estimate,
fill = Sex %>% factor(levels = rev(unique(ca_pums_IRC$Sex)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Household income",
y = "Number of households",
title = "California personal income by sex: Individuals in same-sex relationships",
fill = "Race"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
ca_pums_IRC <-
cleaned %>%
filter(
(CPLT %in% c(2, 4)) #Filtering out opposite-sex couples
) %>%
mutate(
PWGTP = as.numeric(PWGTP),
PINCP = as.numeric(PINCP),
income =  ifelse(
(PINCP <= 20000),
"$20,000 or less",
PINCP
),
income = ifelse(
(PINCP > 20001 & PINCP <= 50000),
"$20,001 to $50,000",
income
),
income = ifelse(
(PINCP > 50001 & PINCP <= 80000),
"$50,001 to $80,000",
income
),
income = ifelse(
(PINCP > 80001 & PINCP <= 100000),
"$80,001 to $100,000",
income
),
income = ifelse(
(PINCP > 100001 & PINCP <= 150000),
"$100,001 to $150,000",
income
),
income = ifelse(
(PINCP > 150001 & PINCP <= 200000),
"$150,001 to $200,000",
income
),
income = ifelse(
(PINCP > 200001 & PINCP <= 250000),
"$200,001 to $250,000",
income
),
income = ifelse(
(PINCP > 250001),
"$250,001 or more",
income
),
Sex = ifelse(
(SEX == 1),
"Male",
"Female"
))
ca_sex_total <-
ca_pums_IRC %>%
group_by(Sex) %>%
summarize(estimate = sum(PWGTP)) %>%
mutate(income = "Total")
ca_pums_IRC %>%
group_by(income, Sex) %>%
summarize(estimate = sum(PWGTP)) %>%
rbind(ca_sex_total) %>%
ggplot() +
geom_bar(
aes(
x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
y = estimate,
fill = Sex %>% factor(levels = rev(unique(ca_pums_IRC$Sex)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Household income",
y = "Number of households",
title = "California personal income by sex: Individuals in same-sex relationships",
fill = "Race"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
ca_pums_IRC <-
cleaned %>%
filter(
(CPLT %in% c(1, 3)) #Filtering out same-sex couples
) %>%
mutate(
PWGTP = as.numeric(PWGTP),
PINCP = as.numeric(PINCP),
income =  ifelse(
(PINCP <= 20000),
"$20,000 or less",
PINCP
),
income = ifelse(
(PINCP > 20001 & PINCP <= 50000),
"$20,001 to $50,000",
income
),
income = ifelse(
(PINCP > 50001 & PINCP <= 80000),
"$50,001 to $80,000",
income
),
income = ifelse(
(PINCP > 80001 & PINCP <= 100000),
"$80,001 to $100,000",
income
),
income = ifelse(
(PINCP > 100001 & PINCP <= 150000),
"$100,001 to $150,000",
income
),
income = ifelse(
(PINCP > 150001 & PINCP <= 200000),
"$150,001 to $200,000",
income
),
income = ifelse(
(PINCP > 200001 & PINCP <= 250000),
"$200,001 to $250,000",
income
),
income = ifelse(
(PINCP > 250001),
"$250,001 or more",
income
),
Sex = ifelse(
(SEX == 1),
"Male",
"Female"
))
ca_sex_total <-
ca_pums_IRC %>%
group_by(Sex) %>%
summarize(estimate = sum(PWGTP)) %>%
mutate(income = "Total")
ca_pums_IRC %>%
group_by(income, Sex) %>%
summarize(estimate = sum(PWGTP)) %>%
rbind(ca_sex_total) %>%
ggplot() +
geom_bar(
aes(
x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
y = estimate,
fill = Sex %>% factor(levels = rev(unique(ca_pums_IRC$Sex)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Household income",
y = "Number of households",
title = "California personal income by sex: Individuals in opposite-sex relationships",
fill = "Race"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
knitr::opts_chunk$set(
echo = F,
message = FALSE,
warning = FALSE
)
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
library(censusapi)
library(gtools)
Sys.setenv(CENSUS_KEY="9fbd5ddd430b595b8f3715733cae2b75c18be92e")
# pums_2019_1yru <- getCensus(
#   name = "acs/acs1/pums",
#   vintage = 2019,
#   region = "public use microdata area:*",
#   regionin = "state:1,2,4,5,6,8,9,10,11,12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,44,45,46,47,48,49,50,51,53,54,55,56",
#   vars = c(
#     "SERIALNO", #Unique ID for each household
#     "SPORDER", #Person number
#     "PWGTP", #Total number of people
#     "CPLT", #Couple Type
#     "PINCP", #Total Persons Income
#     "RAC1P" #Recorded Detailed Race Code
#   )
# )
# saveRDS(pums_2019_1yru, "usa_pums.rds")
pums_2019_1yru <- readRDS("usa_pums.rds")
us_pumas <-
pumas(state = NULL, cb = T, progress_bar = F)
counties <-
counties(state = NULL, cb = T, progress_bar = F)
us_pumas <-
us_pumas %>%
st_centroid() %>%
.[counties, ] %>%
st_drop_geometry() %>%
left_join(us_pumas %>% select(GEOID10)) %>%
st_as_sf()
us_pums <-
pums_2019_1yru %>%
mutate(
PUMA = str_pad(public_use_microdata_area,5,"left","0")
) %>%
filter(PUMA %in% us_pumas$PUMACE10)
