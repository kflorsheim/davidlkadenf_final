---
title: "Exploring the Relationship between Intersectional Identities and Personal Income for Same-sex Couples in the United States"
author: "Kaden Florsheim & David Lüdeke"
date: "12/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = F,
	message = FALSE,
	warning = FALSE
)
```

```{r library}
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
library(censusapi)
library(gtools)
Sys.setenv(CENSUS_KEY="9fbd5ddd430b595b8f3715733cae2b75c18be92e")
```

<br>


# Introduction & Motivation: 

According to the United States Census Bureau, households with same-sex couples have a higher median income than households with opposite-sex couples: $107,200 and $96,930 respectively. This statistic, however, does not take into account many other factors that can impact a same-sex household. For example, when the data is diaggregated by gender, the median household income of same-sex female households is only $95,720 which is less than the median for opposite-sex couples. This raises several questions about how intersectional identities might impact same-sex and opposite-sex couples differently. Is the ratio of personal income for men to women different for individuals from same-sex couples versus opposite-sex couples? What happens when the data is disaggregated by race? Are same-sex couples from certain racial groups disproportionately low-income when compared to their opposite-sex counterparts?

In this project, we analyze the personal incomes of individuals in same-sex and opposite-sex couples, and disaggregate the data by race, couple type, and gender. Using Public Use Microdata Sample (PUMS) data from 2019, we are able to perform equity analyses of personal income by these three factors. Since same-sex married couples account for only 1% of the married couple households in the United States and only 5.1% of unmarried couples, we decided to combine individuals in married and unmarried relationships for both the same-sex couples group and the opposite-sex couples group. Combining the married/unmarried statuses into a more general “relationship” that is either same-sex or opposite-sex is especially important given that opposite-sex couples have a much higher marriage rate (88%) than same-sex couples (58%).

The scope and robustness of our analysis was sometimes limited by the availability of certain data—some regions in the United States had no data for same-sex couples, while certain racial groups had too little data to be included. Fortunately, we were able to overcome these limitations in a couple ways. First, we analyzed national data and then focused in on two states that had both racial diversity and sufficient same-sex couple data to perform more meaningful analysis. Second, we filtered out the racial categories that didn’t have sufficient data on individuals in same-sex couples. In the remainder of this report, we’ve included our sources for background information and data, a roadmap describing the flow of our analysis, a link to our interactive Dashboard, three sections of data visualization and analysis, and our concluding thoughts and takeaways.

<br> 


<br>

### Sources:

<br>

#### Background:
1. https://www.census.gov/library/stories/2020/09/same-sex-married-couples-have-higher-income-than-opposite-sex-married-couples.html
2. https://www.seattletimes.com/nation-world/married-gay-couples-beat-straight-couples-in-income/
3. https://hbr.org/2017/12/gay-men-used-to-earn-less-than-straight-men-now-they-earn-more
4. https://www.pewresearch.org/fact-tank/2021/07/07/on-some-demographic-measures-people-in-same-sex-marriages-differ-from-those-in-opposite-sex-marriages/


#### Data:

##### Dataset: 
ACS 1-Year Estimates 1-Year Estimates-Public Use Microdata Sample (2019)

##### Variables used:
"SERIALNO" = Unique ID for each household, "SPORDER" = Person number, "PWGTP" = Total number of people, "CPLT" = Couple Type, “PINCP" = Total Persons Income, "RAC1P" = Recorded Detailed Race Code, and “SEX” = Individual’s sex.


<br>

<br>

<br>

# Roadmap

The following sections of data visualization and analysis have been split into three parts, each one focusing on disaggregating a different aspect of personal identity. We aim to use these data to more deeply understand the ways in which race and gender intersect with sexual orientation to influence an individual’s outcomes (using personal income as a proxy for success/opportunity).

Part 1 disaggregates by couple type, performing an equity analysis of personal income by race for same-sex and then opposite-sex couples separately. This is the broadest analysis, and displays data for three geographic regions: the whole USA, Florida, and California. For the whole country and for Florida, we include maps that display the percent of all couples that are same-sex in each PUMA region. For California, we display the raw number of individuals in same-sex couples to provide another perspective on the lopsided quantity of same-sex vs. opposite-sex data. 

Part 2 does a deeper dive into California data alone. We disaggregate the data by race, performing equity analyses of personal income by couple-type for each race individually. In addition to equity analyses, this section leverages Leaflet maps to display the percent of individuals in relationships that are low-income (making less than $50,000 annually), allowing us to visually compare the impact of couple type on socioeconomic status.

Lastly, Part 3 continues to focus on California data and examines the impact of gender on income equity. We compare the income ratios of men to women for both couple types, and then compare income ratios of same-sex to opposite-sex individuals of the same gender. (Note: gender and sex are used interchangeably in this report--the only options for sex given on the survey are male and female, with no question about gender identity.)


<br>

<br>

<br>

# Shiny Dashboard
### Link: https://dludeke.shinyapps.io/Final_KadenFDavidL/
This Dashboard provides an alternate interactive way to view the data presented in Part 1, an equity analysis of personal income by race. The user can toggle between viewing data for same-sex couples and opposite-sex couples to visually compare the two. In addition, the user can choose between the three geographic regions: data from the entire country, data from Florida, and data from California. 

<br>

<br>

<br>

# Part 1: Couple Type
## Equity Analysis of Personal Income by Race, Disaggregated by Couple Type

```{r loading US ACS}
# pums_2019_1yru <- getCensus(
#   name = "acs/acs1/pums",
#   vintage = 2019,
#   region = "public use microdata area:*", 
#   regionin = "state:1,2,4,5,6,8,9,10,11,12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,44,45,46,47,48,49,50,51,53,54,55,56",
#   vars = c(
#     "SERIALNO", #Unique ID for each household
#     "SPORDER", #Person number
#     "PWGTP", #Total number of people
#     "CPLT", #Couple Type
#     "PINCP", #Total Persons Income
#     "RAC1P" #Recorded Detailed Race Code
#   )
# )
# saveRDS(pums_2019_1yru, "usa_pums.rds")
```

```{r ACS US}
pums_2019_1yru <- readRDS("usa_pums.rds") %>% 
  mutate(
  state =  ifelse(
      (state == 1),
       paste0("0", state),
      state),
  state =  ifelse(
      (state == 2),
       paste0("0", state),
      state),
  state =  ifelse(
      (state == 4),
       paste0("0", state),
      state),
  state =  ifelse(
      (state == 5),
       paste0("0", state),
      state),
  state =  ifelse(
      (state == 6),
       paste0("0", state),
      state),
  state =  ifelse(
      (state == 8),
       paste0("0", state),
      state),
  state =  ifelse(
      (state == 9),
       paste0("0", state),
      state),
  state_puma = paste0(state,"0", public_use_microdata_area))
    
us_pumas <-
  pumas(state = NULL, cb = T, progress_bar = F)

counties <-
  counties(state = NULL, cb = T, progress_bar = F)

us_pumas <-
  us_pumas %>% 
  st_centroid() %>% 
  .[counties, ] %>% 
  st_drop_geometry() %>% 
  left_join(us_pumas %>% select(GEOID10)) %>% 
  st_as_sf()

us_pums <-
  pums_2019_1yru %>% 
  mutate(
    PUMA = str_pad(public_use_microdata_area,5,"left","0"),
    GEOID = str_pad(state_puma,5,"left","0") 
  ) %>% 
  filter(GEOID %in% us_pumas$GEOID10)
```

```{r cleaned us}
cleaned <- us_pums %>%
  mutate(
    SPORDER = as.numeric(SPORDER),
    CPLT = as.numeric(CPLT)
  ) %>% 
  filter(
    (SPORDER %in% 1:2), #Only using head of household data so that household income is not double counted thus skewing results.
    (CPLT %in% 1:4)) #filtering out N/A
```

```{r us pop data}
us_pums_pop <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9))) %>%
  mutate(
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>%
  group_by(GEOID) %>%
  summarize(
    samesex = sum(same_sex, na.rm = T),
    total_pop = sum(CPLT, na.rm = T)
  ) %>%
  mutate(
    percent = samesex/total_pop*100
  ) %>%
    left_join(
    us_pumas %>%
      select(GEOID10),
    by = c("GEOID" = "GEOID10")
  ) %>%
  st_as_sf()
saveRDS(us_pums_pop, "usa_pums_pop.rds")
```

<br>

## USA:
### Proportion of couples who are same-sex
```{r map US}
pums_2019_1yru <- readRDS("usa_pums_pop.rds")

couple_pal <- colorNumeric(
  palette = "Blues",
  domain = 
    c(0,5)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = us_pums_pop, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% same-sex couples"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = us_pums_pop,
    pal = couple_pal,
    values = 0:5,
    title = "% same-sex relationships"
  )

```

To maintain a more observable color gradient, a few outliers were filtered out. Palm Springs was the largest and had 17.62% same-sex couples.

Most of the PUMA's had between 0% and 2% same-sex couples. It is important to note that in this assignment the populations that we are comparing (Same-sex couples vs. Opposite Sex Couples) are vastly different sizes.

Some races were filtered out of the US and Florida maps so that they will be easier to compare to the California map. We filtered out these races because the same-sex sample size was too small.

Key Assumptions: We are assuming that the first two SPORDER (person numbers: 1, 2) are the two people in the relationship. Additionally, there are no census questions directly asking for sexualitys, but there are questions pertaining to the gender of the two heads of households and their marital status (married or unmarried). Since we are only working with couples data, the number of people that we are using in each data set is reduced. We are including unmarried couples and assuming that they are in a cohabitation agreement. 



```{r US race / income}
us_pums_IRC <-
  cleaned %>%
  filter(
    (CPLT %in% c(2, 4)), #Filtering out opposite-sex couples
    (RAC1P %in% c(1,2,3,6,9))) %>%  #Filtering out RAC1P variables that don't have enough data (Alaska Native alone,American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races, Native Hawaiian and Other Pacific Islander alone)
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    race = ifelse(
      (RAC1P == 1),
      "White Only",
      RAC1P
    ),
    race = ifelse(
      (RAC1P == 2),
      "Black or African American alone",
      race
    ),
    race = ifelse(
      (RAC1P == 3),
      "American Indian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 6),
      "Asian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 8),
      "Some other race alone",
      race
    ),
    race = ifelse(
      (RAC1P == 9),
      "Two or More Races",
      race
    )) 
```

```{r income order}
order <- c( "$20,000 or less", "$20,001 to $50,000","$50,001 to $80,000","$80,001 to $100,000","$100,001 to $150,000","$150,001 to $200,000","$200,001 to $250,000","$250,001 or more")
```

<br> 

## USA: 
### Same-sex equity analysis
```{r us same-sex equity analysis}
us_race_total <-
  us_pums_IRC %>%
  group_by(race) %>%
  summarize(estimate = sum(PWGTP)) %>%
  mutate(income = "Total")

usa_chart_data <- us_pums_IRC %>%
  group_by(income, race) %>%
  summarize(estimate = sum(PWGTP)) %>%
  rbind(us_race_total)

saveRDS(usa_chart_data, "usa_chart_data.rds")
```

```{r}
usa_chart_data <- readRDS("usa_chart_data.rds")

usa_chart_data %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = race 
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "US personal income by race: Individuals in same-sex relationships",
    fill = "Race"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

Across the US, there are observable inequities among races within same-sex communities. White people make up a slightly disproportionate number of people making over $250,001 and also a disproportinatly low number of people making less than $20,000. Asian American people make up a consistent proportion of people at every level. Two or more Races makes up a disproportionate amount of people making less than $20,000. Black or African American people also make up a disproportinate number of people making less than $20,000 and then make up a disproportionately low number at higher income tiers ($50,000 and up.) This plot does suggest inequities that are particularly advantageous for white people and disadvantageous for black or African American people. 


```{r US race and income}
us_pums_IRC <-
  cleaned %>%
  filter(
    (CPLT %in% c(1, 3)), #Filtering out opposite-sex couples
    (RAC1P %in% c(1,2,3,6,9))) %>%  #Filtering out RAC1P variables that don't have enough data (Alaska Native alone,American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races, Native Hawaiian and Other Pacific Islander alone)
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    race = ifelse(
      (RAC1P == 1),
      "White only",
      RAC1P
    ),
    race = ifelse(
      (RAC1P == 2),
      "Black or African American alone",
      race
    ),
    race = ifelse(
      (RAC1P == 3),
      "American Indian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 6),
      "Asian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 9),
      "Two or More Races",
      race
    )) 
```

<br> 

## USA: 
### Opposite-sex equity analysis
```{r US opposite-sex equity analysis}
us_race_total <-
  us_pums_IRC %>% 
  group_by(race) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

usa_chart_data_opp <- us_pums_IRC %>%
  group_by(income, race) %>%
  summarize(estimate = sum(PWGTP)) %>%
  rbind(us_race_total)

saveRDS(usa_chart_data_opp, "usa_chart_data_opp.rds")
```


```{r}
usa_chart_data_opp <- readRDS("usa_chart_data_opp.rds")

usa_chart_data_opp %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = race 
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "US personal income by race: Individuals in opposite-sex relationships",
    fill = "Race"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

Among people in opposite-sex relationships, similar trends prevail in the data however to a smaller degree. The proportions for White only and Two or More Races at every income tier are more consistent. Black or African American people make up a larger proportion of low-income people and a smaller proportion of high income people. Asian Americans on average make up a slightly larger proportion of high income people. 


```{r loading Florida ACS data}
# pums_2019_1yrf <- getCensus(
#   name = "acs/acs1/pums",
#   vintage = 2019,
#   region = "public use microdata area:*",
#   regionin = "state:12",
#   vars = c(
#     "SERIALNO", #Unique ID for each household
#     "SPORDER", #Person number
#     "PWGTP", #Total number of people
#     "CPLT", #Couple Type
#     "PINCP", #Total Persons Income
#     "RAC1P" #Recorded Detailed Race Code
# 
#   )
# )
# saveRDS(pums_2019_1yrf, "florida_pums.rds")
```

```{r ACS Florida}
pums_2019_1yrf <- readRDS("florida_pums.rds")

fl_pumas <-
  pumas("FL", cb = T, progress_bar = F)

counties <-
  counties("FL", cb = T, progress_bar = F)

fl_pumas <-
  fl_pumas %>% 
  st_centroid() %>% 
  .[counties, ] %>% 
  st_drop_geometry() %>% 
  left_join(fl_pumas %>% select(GEOID10)) %>% 
  st_as_sf()

fl_pums <-
  pums_2019_1yrf %>% 
  mutate(
    PUMA = str_pad(public_use_microdata_area,5,"left","0")
  ) %>% 
  filter(PUMA %in% fl_pumas$PUMACE10)
```

```{r Florida Cleaned}
cleaned <- fl_pums %>%
  mutate(
    SPORDER = as.numeric(SPORDER),
    CPLT = as.numeric(CPLT)
  ) %>% 
  filter(
    (SPORDER %in% 1:2), #Only using head of household data so that household income is not double counted thus skewing results.
    (CPLT %in% 1:4)) #filtering out N/A
```

<br> 

## Florida:
### Proportion of couples who are same-sex
```{r Florida Pop}
fl_pums_pop <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9))) %>% 
  mutate(
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    samesex = sum(same_sex, na.rm = T),
    total_pop = sum(CPLT, na.rm = T)
  ) %>% 
  mutate(
    percent = samesex/total_pop*100
  ) %>% 
    left_join(
    fl_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()
```

```{r Florida Map}
couple_pal <- colorNumeric(
  palette = "Blues",
  domain = 
    c(0,5)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = fl_pums_pop, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% same-sex couples"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = fl_pums_pop,
    pal = couple_pal,
    values = 0:5,
    title = "% same-sex relationships"
  )

```

To maintain a more observable color gradient, a few outliers were filtered out. The largest PUMA was in Fort Lauderdale and it had 6.88% same-sex couples.

We wanted to see how the inequities in another populous state would compare to the inequities in California. We chose Florida because it is the third largest state by population (after California and Texas), but it is also more diverse than Texas. 

```{r Florida Race and Income Same-Sex}
fl_pums_IRC <-
  cleaned %>%
  filter(
    (CPLT %in% c(2, 4)), #Filtering out opposite-sex couples
    (RAC1P %in% c(1,2,3,6,8,9))) %>%  #Filtering out RAC1P variables that don't have enough data (Alaska Native alone,American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races, Native Hawaiian and Pacific Islander alone)
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    race = ifelse(
      (RAC1P == 1),
      "White Only",
      RAC1P
    ),
    race = ifelse(
      (RAC1P == 2),
      "Black or African American alone",
      race
    ),
    race = ifelse(
      (RAC1P == 3),
      "American Indian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 6),
      "Asian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 8),
      "Other Race",
      race
    ),
    race = ifelse(
      (RAC1P == 9),
      "Two or More Races",
      race
    )) 
```

<br> 

## Florida: 
### Same-sex equity analysis
```{r Florida Equity Analysis Same-Sex}
fl_race_total <-
  fl_pums_IRC %>% 
  group_by(race) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

fl_chart_data <- fl_pums_IRC %>%
  group_by(income, race) %>%
  summarize(estimate = sum(PWGTP)) %>%
  rbind(fl_race_total)

saveRDS(fl_chart_data, "fl_chart_data.rds")
```


```{r}
fl_chart_data <- readRDS("fl_chart_data.rds")

fl_chart_data %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = race 
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "Florida personal income by race: Individuals in same-sex relationships",
    fill = "Race"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

We included 'Other Race' in this plot because the results were interesting. 
Generally Florida's personal income equity analysis among people in same-sex relationships is less equitable than the national equity analysis conducted above. White people make up a disproportionately high proportion of people making between $80,001 and $250,000 and they are the only race included that appears in the $200,000 to $250,000 tier. This is most likely due the a lower sample size. Asian people make up a very low proportion of the overall population however they make up a significantly larger proportion of people making $250,001 and more. Black or African American data is similar to the national data. They make up a disproportionately low proportion of the highest income tier and a disproportionately high proportion of the lowest income tier.


```{r Florida Op-Sex Race Income}
fl_pums_IRC <-
  cleaned %>%
  filter(
    (CPLT %in% c(1, 3)), #Filtering out same-sex couples
    (RAC1P %in% c(1,2,3,6,8,9))) %>%  #Filtering out RAC1P variables that don't have enough data (Alaska Native alone,American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races, Native Hawaiian and Other Pacific Islander alone)
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    race = ifelse(
      (RAC1P == 1),
      "White Only",
      RAC1P
    ),
    race = ifelse(
      (RAC1P == 2),
      "Black or African American alone",
      race
    ),
    race = ifelse(
      (RAC1P == 3),
      "American Indian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 6),
      "Asian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 8),
      "Some other race alone",
      race
    ),
    race = ifelse(
      (RAC1P == 9),
      "Two or More Races",
      race
    )) 
```

<br> 

## Florida:
### Opposite-sex equity analysis
```{r Op-Sex Florida Equity An}
fl_race_total <-
  fl_pums_IRC %>% 
  group_by(race) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

fl_chart_data_opp <- fl_pums_IRC %>% 
  group_by(income, race) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(fl_race_total) 

saveRDS(fl_chart_data_opp, "fl_chart_data_opp.rds")
```


```{r}
fl_chart_data_opp <- readRDS("fl_chart_data_opp.rds")

fl_chart_data_opp %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = race %>% factor(levels = rev(unique(fl_pums_IRC$race)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "Florida personal income by race: Individuals in opposite-sex relationships",
    fill = "Race"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

The results for the race-income equity analysis of people in opposite-sex relationships resembles the national results more than the equtiy analysis of people in same-sex relationships--Probably because the sample size is larger. Some other race alone and Black or African American alone make are disproportinaly represented in high income tiers ($80,000 and up.)


```{r Loading California ACS Data}
# pums_2019_1yr <- getCensus(
#   name = "acs/acs1/pums",
#   vintage = 2019,
#   region = "public use microdata area:*", 
#   regionin = "state:06",
#   vars = c(
#     "SERIALNO", #Unique ID for each household
#     "SPORDER", #Person number
#     "PWGTP", #Total number of people
#     "WGTP", #Housing Weight
#     "HINCP", #Household Income
#     "CPLT", #Couple Type
#     "FINCP", #Family Income
#     "PINCP", #Total Persons Income
#     "RAC1P", #Recorded Detailed Race Code
#     "SEX" #sex
#   )
# )
# saveRDS(pums_2019_1yr, "final_pums.rds")
```

```{r ACS CA}
pums_2019_1yr <- readRDS("final_pums.rds")

ca_pumas <-
  pumas("CA", cb = T, progress_bar = F)

counties <-
  counties("CA", cb = T, progress_bar = F)

ca_pumas <-
  ca_pumas %>% 
  st_centroid() %>% 
  .[counties, ] %>% 
  st_drop_geometry() %>% 
  left_join(ca_pumas %>% select(GEOID10)) %>% 
  st_as_sf()

ca_pums <-
  pums_2019_1yr %>% 
  mutate(
    PUMA = str_pad(public_use_microdata_area,5,"left","0")
  ) %>% 
  filter(PUMA %in% ca_pumas$PUMACE10)
```

```{r California Cleaned}
cleaned <- ca_pums %>%
  mutate(
    SPORDER = as.numeric(SPORDER),
    CPLT = as.numeric(CPLT)
  ) %>% 
  filter(
    (SPORDER %in% 1:2), #Only using head of household data so that household income is not double counted thus skewing results.
    (CPLT %in% 1:4)) #filtering out N/A
```

<br>

## California:
### Number of individuals in same-sex relationships
```{r California Pop}
ca_pums_pop <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9))) %>% 
  mutate(
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    samesex = sum(same_sex, na.rm = T)) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Blues",
  domain = 
    c(0,59)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_pop, 
    fillColor = ~couple_pal (samesex),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      samesex,
      " individuals in same-sex relationships"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_pop,
    pal = couple_pal,
    values = 0:58,
    title = "individuals in same-sex relationships"
  )

```

For this map we decided to include the actual counts of people in same-sex relationships rather than the percentages. This is another reminder of the sample size and how low it is in reality. 

To maintain a more observable color gradient, a few outliers were filtered out. Palm Springs was the largest and had 320 people same-sex relationships.


```{r CA Race and Income}
ca_pums_IRC <-
  cleaned %>%
  filter(
    (CPLT %in% c(2, 4)), #Filtering out opposite-sex couples
    (RAC1P %in% c(1,2,3,6,9))) %>%  #Filtering out RAC1P variables that don't have enough data (Alaska Native alone,American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races, Native Hawaiian and Other Pacific Islander alone, Some Other Race alone)
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    race = ifelse(
      (RAC1P == 1),
      "White Only",
      RAC1P
    ),
    race = ifelse(
      (RAC1P == 2),
      "Black or African American alone",
      race
    ),
    race = ifelse(
      (RAC1P == 3),
      "American Indian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 6),
      "Asian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 9),
      "Two or More Races",
      race
    )) 
```

<br>

## California: 
### Same-sex equity analysis
```{r Same-Sex CA Equity Analysis RDS}
ca_race_total <-
  ca_pums_IRC %>% 
  group_by(race) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_chart_data <- ca_pums_IRC %>% 
  group_by(income, race) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_race_total) 

saveRDS(ca_chart_data, "ca_chart_data.rds")
```


```{r}
ca_chart_data <- readRDS("ca_chart_data.rds")

ca_chart_data %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = race %>% factor(levels = rev(unique(ca_pums_IRC$race)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California personal income by race: Individuals in same-sex relationships",
    fill = "Race"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

This equity analysis has the least consistent data of the three for same-sex (USA, Florida, California.) White Only make up a disproportiate ammount of people making $250,000 alone but other than that they are pretty proportionate at every tier. Asian alone make up a slightly higher proportion of people making $200,001 to $250,000 and a lower proportion of people making $250,000 or more. American Indians make up a slightly higher proportion of people making between $20,001 and $50,000. Two or more races is pretty proportionate at every income tier except '$250,000 or more.' The most observable trend in Black or African American, which shrink in proportions as the income tier increases, but to a smaller degree than the other equity analysis'. The income tiers between $0 and $50,000 are consistent with the total population data.



```{r CA Race and Income Op-Sex}
ca_pums_IRC <-
  cleaned %>%
  filter(
    (CPLT %in% c(1, 3)), #Filtering out same-sex couples
    (RAC1P %in% c(1,2,3,6,9))) %>%  #Filtering out RAC1P variables that don't have enough data (Alaska Native alone,American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races, Native Hawaiian and Other Pacific Islander alone, Some Other Race alone)
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    race = ifelse(
      (RAC1P == 1),
      "White Only",
      RAC1P
    ),
    race = ifelse(
      (RAC1P == 2),
      "Black or African American alone",
      race
    ),
    race = ifelse(
      (RAC1P == 3),
      "American Indian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 6),
      "Asian alone",
      race
    ),
    race = ifelse(
      (RAC1P == 9),
      "Two or More Races",
      race
    ))  
```

<br>

## California: 
### Opposite-sex equity analysis
```{r Op-Sex CA equity Analysis}
ca_race_total <-
  ca_pums_IRC %>% 
  group_by(race) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_chart_data_opp <- ca_pums_IRC %>% 
  group_by(income, race) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_race_total)

saveRDS(ca_chart_data_opp, "ca_chart_data_opp.rds")
```


```{r}
ca_chart_data_opp <- readRDS("ca_chart_data_opp.rds")

ca_chart_data_opp %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = race %>% factor(levels = rev(unique(ca_pums_IRC$race)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California personal income by race: Individuals in opposite-sex relationships",
    fill = "Race"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  ) 
```

This is the most consistent equity analysis. There is a much larger proportion of Asian people in California than in Florida or USA. This data suggests that there is more racial inequity within same-sex couple groupings than opposite-sex couple groupings. 

<br>

<br>

<br>

# Part 2: Race
## Equity Analysis of Personal Income by Couple Type, Disaggregated by Race

<br> 

### All Races

See below for each race individually.

<br>

```{r Same-Sex making less than 50k}
ca_pums_income_same <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9))) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 2)|(CPLT == 4)) & (PINCP <= 50000),
       1,
      0),
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    same_sex_pop = sum(same_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/same_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_same, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% people in same-sex relationships with a personal income of less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:100,
    title = "% same-sex relationships"
  )

```

This map reveals the percentage of people within each PUMA that make below $50,000 dollars. Grey PUMAs are PUMAs that did not have same-sex couple data.
The is a large range of data. Some PUMAs have 100% low income same-sex couples and there is also a PUMA that has 0%.

<br>

```{r Op-sex  making less than 50k}
ca_pums_income_op <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9))) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 1)|(CPLT == 3)) & (PINCP <= 50000),
       1,
      0),
    op_sex = ifelse(
        (CPLT == 1)|(CPLT == 3),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    op_sex_pop = sum(op_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/op_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_op, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% people in opposite-sex relationships with a personal income of less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_op,
    pal = couple_pal,
    values = 0:100,
    title = "% opposite-sex relationships"
  )

```

This map reveals the percentage of people within each PUMA that make below $50,000 dollars. Grey PUMAs are PUMAs that did not have opposite-sex couple data.
This data is consistently arount the %40-%60 range.


```{r Income}
ca_pums_IRC <-
  cleaned %>%
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    RAC1P = as.numeric(RAC1P),
    Same_sex_household = ifelse(
        (CPLT == 2)|(CPLT == 4), #Same-sex married couple|same-sex unmarried couple
      "Same sex couple",
      "Opposite sex couple"
    ),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ))
```  
 
```{r Map Income cplt}
ca_race_total <-
  ca_pums_IRC %>% 
  group_by(Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_race_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California personal income by couple type",
    fill = "Couple Type"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

There does not appear to be a large change in proportions across different income tiers. Same-sex couples make up a slightly high proportion of people making $200,001 to $250,000.

<br>

### White Alone

<br>

```{r same-sex white map}
ca_pums_income_same <-
  cleaned %>%
  filter(
    (RAC1P %in% 1)) %>% #white alone 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 2)|(CPLT == 4)) & (PINCP <= 50000),
       1,
      0),
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    same_sex_pop = sum(same_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/same_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_same, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in same-sex relationships (white) making less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:100,
    title = "% in same-sex relationships (white)<br>making less than $50,000"
  )

```

This map reveals the percentage of people within each PUMA that make below $50,000 dollars. Grey PUMAs are PUMAs that did not have same-sex couple data.


<br> 


```{r op-sex white map}
ca_pums_income_op <-
  cleaned %>%
  filter(
    (RAC1P %in% 1)) %>% #white alone  
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 1)|(CPLT == 3)) & (PINCP <= 50000),
       1,
      0),
    op_sex = ifelse(
        (CPLT == 1)|(CPLT == 3),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    op_sex_pop = sum(op_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/op_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_op, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in opposite-sex relationships (white) making less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_op,
    pal = couple_pal,
    values = 0:100,
    title = "% in opposite-sex relationships (white)<br>making less than $50,000"
  )

```

This map reveals the percentage of people within each PUMA that make below $50,000. Grey PUMAs are PUMAs that did not have same-sex couple data.

There appears to be a low average percentage of people making less than $50,000. PUMAS that are located in the Bay Area and near cities like Los Angeles have lower percentage than more inland PUMAS.

```{r white income}
ca_pums_IRC <-
  cleaned %>%
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    Same_sex_household = ifelse(
        (CPLT == 2)|(CPLT == 4), 
      "Same sex couple",
      "Opposite sex couple"
    ),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    RAC1P = as.numeric(RAC1P)
  ) %>% 
  filter(
    (RAC1P %in% 1)) #white alone
```

<br> 

```{r white cplt equity an}
ca_white_total <-
  ca_pums_IRC %>% 
  group_by(Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_white_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California white personal income by couple type",
    fill = "Couple Type"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

There does not appear to be a large change in proportions across different income tiers


<br>


### Black or African American alone

<br>

```{r map same-sex black}
ca_pums_income_same <-
  cleaned %>%
  filter(
    (RAC1P %in% 2)) %>% #black alone 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 2)|(CPLT == 4)) & (PINCP <= 50000),
       1,
      0),
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    same_sex_pop = sum(same_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/same_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_same, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in same-sex relationships (black) making less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:100,
    title = "% in same-sex relationships (black)<br>making less than $50,000"
  )

```

This map reveals the percentage of people within each PUMA that make below $50,000. Grey PUMAs are PUMAs that did not have same-sex couple data. There are many grey areas due to a small sample size and most of the PUMA's appear to be low-income.

<br>

```{r map op-sex black }
ca_pums_income_op <-
  cleaned %>%
  filter(
    (RAC1P %in% 2)) %>% #black alone  
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 1)|(CPLT == 3)) & (PINCP <= 50000),
       1,
      0),
    op_sex = ifelse(
        (CPLT == 1)|(CPLT == 3),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    op_sex_pop = sum(op_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/op_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_op, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in opposite-sex relationships (black) making less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_op,
    pal = couple_pal,
    values = 0:100,
    title = "% in opposite-sex relationships (black)<br>making less than $50,000"
  )

```

This map reveals the percentage of people within each PUMA that make below $50,000. Grey PUMAs are PUMAs that did not have same-sex couple data.

<br>

```{r income black}
ca_pums_IRC <-
  cleaned %>%
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    Same_sex_household = ifelse(
        (CPLT == 2)|(CPLT == 4), 
      "Same sex couple",
      "Opposite sex couple"
    ),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    RAC1P = as.numeric(RAC1P)
  ) %>% 
  filter(
    (RAC1P %in% 2)) #Black or African American alone
```


```{r black cplt equity analysis}
ca_black_total <-
  ca_pums_IRC %>% 
  group_by(Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_black_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California Black personal income by couple type",
    fill = "Couple Type"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

There does not appear to be a large change in proportions across different income tiers. Same-sex couples make up a larger proportion of people making $200,001 to $250,000.


<br>


### Asian American Alone

```{r asian map same-sex}
ca_pums_income_same <-
  cleaned %>%
  filter(
    (RAC1P %in% 6)) %>% #Asian alone 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 2)|(CPLT == 4)) & (PINCP <= 50000),
       1,
      0),
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    same_sex_pop = sum(same_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/same_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_same, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in same-sex relationships (Asian American) with a personal income of less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:100,
    title = "% in same-sex relationships (Asian American)<br>with a personal income of less than $50,000"
  )

```

This map reveals the percentage of Asian Americans in same-sex couples who make less than $50,000 per year. Lower percentages are concentrated around San Francisco and Los Angeles, while most of the rest of California either has a higher percentage of low-income or doesn’t have enough data.

<br>

```{r Asian map op-sex}
ca_pums_income_op <-
  cleaned %>%
  filter(
    (RAC1P %in% 6)) %>% #Asian alone  
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 1)|(CPLT == 3)) & (PINCP <= 50000),
       1,
      0),
    op_sex = ifelse(
        (CPLT == 1)|(CPLT == 3),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    op_sex_pop = sum(op_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/op_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_op, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in opposite-sex relationships (Asian American) with a personal income of less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_op,
    pal = couple_pal,
    values = 0:100,
    title = "in opposite-sex relationships (Asian American)<br>with a personal income of less than $50,000"
  )

```

This map for opposite-sex Asian Americans shows a similar trend as for same-sex where lower percentages can be found near the major cities.

<br>

```{r Asian Income}
ca_pums_IRC <-
  cleaned %>%
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    Same_sex_household = ifelse(
        (CPLT == 2)|(CPLT == 4), 
      "Same sex couple",
      "Opposite sex couple"
    ),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    RAC1P = as.numeric(RAC1P)
  ) %>% 
  filter(
    (RAC1P %in% 6)) #Asian American alone
```

```{r Asian CPLT Equity AN}
ca_asian_total <-
  ca_pums_IRC %>% 
  group_by(Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_asian_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California Asian American personal income by couple type",
    fill = "Couple Type"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

There doesn’t seem to be a trend in the way proportions change across income tiers. 


```{r American Indian Alone}
ca_pums_IRC <-
  cleaned %>%
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    Same_sex_household = ifelse(
        (CPLT == 2)|(CPLT == 4), 
      "Same sex couple",
      "Opposite sex couple"
    ),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    RAC1P = as.numeric(RAC1P)
  ) %>% 
  filter(
    (RAC1P %in% 3)) #American Indian alone
```


<br>


### American Indian alone

```{r American Indian Same-Sex Map}
ca_pums_income_same <-
  cleaned %>%
  filter(
    (RAC1P %in% 3)) %>% #American Indian alone  
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 2)|(CPLT == 4)) & (PINCP <= 50000),
       1,
      0),
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    same_sex_pop = sum(same_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/same_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_same, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in same-sex relationships (American Indian) with a personal income of less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:100,
    title = "% in same-sex relationships (American Indian)<br>with a personal income of less than $50,000"
  )

```

```{r American Indian Op-Sex Map}
ca_pums_income_op <-
  cleaned %>%
  filter(
    (RAC1P %in% 3)) %>% #American Indian alone  
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 1)|(CPLT == 3)) & (PINCP <= 50000),
       1,
      0),
    op_sex = ifelse(
        (CPLT == 1)|(CPLT == 3),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    op_sex_pop = sum(op_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/op_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_op, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in opposite-sex relationships (American Indian) with a personal income of less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_op,
    pal = couple_pal,
    values = 0:100,
    title = "% in opposite-sex relationships (American Indian)<br>with a personal income of less than $50,000"
  )

```

These maps highlight the lack of data for American Indians in same-sex couples, where PUMAs that aren’t grey are either 100% or 0%. 

<br>

```{r American Indian CPLT Equity An}
ca_AI_total <-
  ca_pums_IRC %>% 
  group_by(Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_AI_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California (American Indian) personal income by couple type",
    fill = "Couple Type"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

This low number of individuals making up this equity analysis unfortunately hinders our ability to draw any meaningful conclusions from the data.


<br>


### Two or More Races
```{r Two or more races-Income}
ca_pums_IRC <-
  cleaned %>%
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    Same_sex_household = ifelse(
        (CPLT == 2)|(CPLT == 4), 
      "Same sex couple",
      "Opposite sex couple"
    ),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    RAC1P = as.numeric(RAC1P)
  ) %>% 
  filter(
    (RAC1P %in% 9)) #Two or More Races
```

```{r Two or More Map Same-Sex}
ca_pums_income_same <-
  cleaned %>%
  filter(
    (RAC1P %in% 9)) %>% #Two or more 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 2)|(CPLT == 4)) & (PINCP <= 50000),
       1,
      0),
    same_sex = ifelse(
        (CPLT == 2)|(CPLT == 4),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    same_sex_pop = sum(same_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/same_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_same, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in same-sex relationships (two or more races) with a personal income of less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:100,
    title = "% in same-sex relationships (two or more races)<br>with a personal income of less than $50,000"
  )

```

```{r Two or More Map Op-Sex}
ca_pums_income_op <-
  cleaned %>%
  filter(
    (RAC1P %in% 9)) %>% #Two or more 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      ((CPLT == 1)|(CPLT == 3)) & (PINCP <= 50000),
       1,
      0),
    op_sex = ifelse(
        (CPLT == 1)|(CPLT == 3),
        1,
        0
  )) %>% 
  group_by(PUMA) %>% 
  summarize(
    income = sum(income, na.rm = T),
    op_sex_pop = sum(op_sex, na.rm = T)
  ) %>% 
  mutate(
    percent = income/op_sex_pop*100
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Reds",
  domain = 
    c(0,100)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_op, 
    fillColor = ~couple_pal (percent),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(percent*100)/100,
      "% in opposite-sex relationships (two or more races) with a personal income of less than $50,000"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_op,
    pal = couple_pal,
    values = 0:100,
    title = "% in opposite-sex relationships (two or more races)<br>with a personal income of less than $50,000"
  )

```

These maps reveal a similar trend to that found in Asian American data, with lower percentages clustered near the large cities and higher percentages found in more rural areas--with a characteristic lack of data for same-sex couples.

<br>

```{r Two People Equity Analysis}
ca_two_total <-
  ca_pums_IRC %>% 
  group_by(Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_two_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California Two-or-More-Races personal income by couple type",
    fill = "Couple Type"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
``` 

This equity analysis for two or more races reveals a mostly constant proportion in each income tier, though for same-sex couples there is a slight over-representation in the lowest income bucket as well as the higher buckets (excluding the last one). 


<br>

<br>

<br>

# Part 3: Sex
## Equity Analysis of Personal Income by Race, Disaggregated by Sex
```{r Same-Sex Gender Equity Analysis Map Average}
ca_pums_income_gender <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9)),
    (CPLT %in% c(2, 4))) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    male = ifelse(
      (SEX == 1),
       1,
      0),
    female = ifelse(
      (SEX == 2),
       1,
      0),
    men_inc = ifelse(
      (SEX == 1),
       PINCP,
      0),
    fem_inc = ifelse(
      (SEX == 2),
       PINCP,
      0)
  ) %>% 
  group_by(PUMA) %>% 
  summarize(
    male = sum(male, na.rm = T),
    female = sum(female, na.rm = T),
    incomem = sum(men_inc, na.rm = T),
    incomef = sum(fem_inc, na.rm = T)) %>% 
  mutate(
    average_female_income = incomef/female,
    average_male_income = incomem/male,
    ratio = average_male_income/average_female_income
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Greens",
  domain = 
    c(0,5)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_gender, 
    fillColor = ~couple_pal (ratio),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(ratio*100)/100,
      " Men:Women"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:5,
    title = "Ratio of personal income Men:Women<br>Individuals in same-sex relationship"
  )
```

```{r Map Average}
ca_pums_income_gender <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9)),
    (CPLT %in% c(1, 3))) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    male = ifelse(
      (SEX == 1),
       1,
      0),
    female = ifelse(
      (SEX == 2),
       1,
      0),
    men_inc = ifelse(
      (SEX == 1),
       PINCP,
      0),
    fem_inc = ifelse(
      (SEX == 2),
       PINCP,
      0)
  ) %>% 
  group_by(PUMA) %>% 
  summarize(
    male = sum(male, na.rm = T),
    female = sum(female, na.rm = T),
    incomem = sum(men_inc, na.rm = T),
    incomef = sum(fem_inc, na.rm = T)) %>% 
  mutate(
    average_female_income = incomef/female,
    average_male_income = incomem/male,
    ratio = average_male_income/average_female_income
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Greens",
  domain = 
    c(0,5)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_gender, 
    fillColor = ~couple_pal (ratio),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(ratio*100)/100,
      " Men:Women"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:5,
    title = "Ratio of personal income Men:Women<br>Individuals in opposite-sex relationship"
  )
```


In these maps, a ratio of 1 indicates men and women earn the same income in that given PUMA. Values higher than 1 represent men earning relatively more than women, while values lower than 1 mean the opposite. 


While men in opposite-sex couples almost unilaterally out-earn women in opposite sex couples by varying multiples, there is more variation found in individuals from same-sex couples. Men and women in same-sex couples out-earn each other in turns depending on the PUMA, with relatively higher-income women more commonly found near cities. 


```{r same-Sex Gender Equity Analysis}
ca_pums_IRC <-
  cleaned %>%
  filter(
    (CPLT %in% c(2, 4)) #Filtering out opposite-sex couples
  ) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    Sex = ifelse(
      (SEX == 1),
      "Male",
      "Female"
    ))  

ca_sex_total <-
  ca_pums_IRC %>% 
  group_by(Sex) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Sex) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_sex_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Sex %>% factor(levels = rev(unique(ca_pums_IRC$Sex)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California personal income by sex: Individuals in same-sex relationships",
    fill = "Sex"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

```{r Op-Sex Gender Equity An}
ca_pums_IRC <-
  cleaned %>%
  filter(
    (CPLT %in% c(1, 3)) #Filtering out same-sex couples
  ) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    Sex = ifelse(
      (SEX == 1),
      "Male",
      "Female"
    ))  

ca_sex_total <-
  ca_pums_IRC %>% 
  group_by(Sex) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Sex) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_sex_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Sex %>% factor(levels = rev(unique(ca_pums_IRC$Sex)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California personal income by sex: Individuals in opposite-sex relationships",
    fill = "Sex"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```


### Equity Analysis of single gender and relationship type
```{r men average}
ca_pums_income_male <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9)),
    (SEX %in% 1)) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    samesex = ifelse(
      (CPLT == 2)|(CPLT == 4),
       1,
      0),
    op_sex = ifelse(
      (CPLT == 1)|(CPLT == 3),
       1,
      0),
    same_inc = ifelse(
      (CPLT == 2)|(CPLT == 4),
       PINCP,
      0),
    op_inc = ifelse(
      (CPLT == 1)|(CPLT == 3),
       PINCP,
      0)
  ) %>% 
  group_by(PUMA) %>% 
  summarize(
    samesex = sum(samesex, na.rm = T),
    opsex = sum(op_sex, na.rm = T),
    income = sum(same_inc, na.rm = T),
    incomeo = sum(op_inc, na.rm = T)) %>% 
  mutate(
    average_same_income = income/samesex,
    average_op_income = incomeo/opsex,
    ratio = average_same_income/average_op_income
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Greens",
  domain = 
    c(0,4.5)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_male, 
    fillColor = ~couple_pal (ratio),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(ratio*100)/100,
      "  Same-Sex:Opposite-Sex (men)"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:5,
    title = "Ratio of personal income<br>Same-Sex:Opposite-Sex (Men)"
  )
  
```

```{r Men Equity Analysis}
ca_pums_IRC <-
  cleaned %>%
  filter(
    (SEX %in% 1) #Filtering out women
  ) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    Same_sex_household = ifelse(
        (CPLT == 2)|(CPLT == 4), #Same-sex married couple|same-sex unmarried couple
      "Same sex couple",
      "Opposite sex couple"
      )) 

ca_ct_total <-
  ca_pums_IRC %>% 
  group_by(Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_ct_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California personal income by couple type: Men",
    fill = "Couple Type"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

This map and equity analysis show that whether men are in a same-sex or opposite-sex relationship doesn’t significantly impact their income tier or likehood of out-earning their male couple type counterparts. 

<br>

```{r women ave}
ca_pums_income_female <-
  cleaned %>%
  filter(
    (RAC1P %in% c(1,2,3,6,9)),
    (SEX %in% 2)) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    samesex = ifelse(
      (CPLT == 2)|(CPLT == 4),
       1,
      0),
    op_sex = ifelse(
      (CPLT == 1)|(CPLT == 3),
       1,
      0),
    same_inc = ifelse(
      (CPLT == 2)|(CPLT == 4),
       PINCP,
      0),
    op_inc = ifelse(
      (CPLT == 1)|(CPLT == 3),
       PINCP,
      0)
  ) %>% 
  group_by(PUMA) %>% 
  summarize(
    samesex = sum(samesex, na.rm = T),
    opsex = sum(op_sex, na.rm = T),
    income = sum(same_inc, na.rm = T),
    incomeo = sum(op_inc, na.rm = T)) %>% 
  mutate(
    average_same_income = income/samesex,
    average_op_income = incomeo/opsex,
    ratio = average_same_income/average_op_income
  ) %>% 
    left_join(
    ca_pumas %>% 
      select(PUMACE10),
    by = c("PUMA" = "PUMACE10")
  ) %>% 
  st_as_sf()

couple_pal <- colorNumeric(
  palette = "Greens",
  domain = 
    c(0,4.5)
)

leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(
    data = ca_pums_income_female, 
    fillColor = ~couple_pal (ratio),
    color = "white",
    opacity = 0.5,
    fillOpacity = 0.75,
    weight = 1,
    label = ~paste0(
      round(ratio*100)/100,
      "  Same-Sex:Opposite-Sex (Women)"
    ),
    highlightOptions = highlightOptions(
      weight = 2,
      opacity = 1
    )
  ) %>% 
  addLegend(
    data = ca_pums_income_same,
    pal = couple_pal,
    values = 0:5,
    title = "Ratio of personal income<br>Same-Sex:Opposite-Sex (Women)"
  )
  
```

```{r Women Equity Analysis}
ca_pums_IRC <-
  cleaned %>%
  filter(
    (SEX %in% 2) #Filtering out men
  ) %>% 
  mutate(
    PWGTP = as.numeric(PWGTP),
    PINCP = as.numeric(PINCP),
    income =  ifelse(
      (PINCP <= 20000),
       "$20,000 or less",
      PINCP
    ),
    income = ifelse(
      (PINCP > 20001 & PINCP <= 50000),
       "$20,001 to $50,000",
      income
    ),
    income = ifelse(
      (PINCP > 50001 & PINCP <= 80000),
       "$50,001 to $80,000",
      income
    ),
    income = ifelse(
      (PINCP > 80001 & PINCP <= 100000),
       "$80,001 to $100,000",
      income
    ),
    income = ifelse(
      (PINCP > 100001 & PINCP <= 150000),
       "$100,001 to $150,000",
      income
    ),
    income = ifelse(
      (PINCP > 150001 & PINCP <= 200000),
       "$150,001 to $200,000",
      income
    ),
    income = ifelse(
      (PINCP > 200001 & PINCP <= 250000),
       "$200,001 to $250,000",
      income
    ),
    income = ifelse(
      (PINCP > 250001),
       "$250,001 or more",
      income
    ),
    Same_sex_household = ifelse(
        (CPLT == 2)|(CPLT == 4), #Same-sex married couple|same-sex unmarried couple
      "Same sex couple",
      "Opposite sex couple"
      )) 

ca_ct_total <-
  ca_pums_IRC %>% 
  group_by(Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  mutate(income = "Total")

ca_pums_IRC %>% 
  group_by(income, Same_sex_household) %>% 
  summarize(estimate = sum(PWGTP)) %>% 
  rbind(ca_ct_total) %>%  
  ggplot() +
  geom_bar(
    aes(
      x = income %>% factor(levels = rev(c("Total", mixedsort(order)))),
      y = estimate,
      fill = Same_sex_household %>% factor(levels = rev(unique(ca_pums_IRC$Same_sex_household)))
    ),
    stat = "identity",
    position = "fill"
  ) +
  labs(
    x = "Personal income",
    y = "Proportion of population",
    title = "California personal income by couple type: Women",
    fill = "Couple Type"
  ) +
  coord_flip() +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical"
  )  +
  guides(
    fill = guide_legend(
      reverse = T
    )
  )
```

The map and equity analysis for women is similar to those for men. However, same-sex women may be slightly over-represented in middle and higher income tiers compared to their opposite-sex women. This is supported by the map, where more PUMAs appear to have ratios over 1, indicating women from same-sex relationships are out-earning their peers.


<br>

<br>

<br>

# Conclusion:

In creating these analyses and data visualizations, we are able to draw several conclusions about the relationship between race, couple type, gender, and personal income. First, by comparing same- and opposite-sex equity analyses of income by race, we see that the disproportionate representation of certain races in certain income brackets is amplified when the individuals are from same-sex couples. 

For instance, Black or African American people in opposite-set relationships are over-represented in lower income tiers (9.3% of the total and 9.9% of the “$20,000 or less” income bucket), but that over-representation increases drastically when looking at people from same-sex couples (10.8% of the total and 16.1% of the “$20,000 or less” income bucket). 

A different trend emerges when comparing same-sex and opposite-sex couples that are Asian American. Those in opposite-sex couples are over-represented in higher income tiers (the “$80,001 to $100,000” bucket and above), while Asian Americans in same-sex relationships are only significantly over-represented in the last three income tiers (above $150,000 income) and even then by a lesser percentage difference. 

(These differences can be seen visually by toggling between opposite-sex and same-sex couple types on the [Dashboard](https://dludeke.shinyapps.io/Final_KadenFDavidL/)). 

These trends lend evidence to the hypothesis that intersectionality of marginalized identities compounds the systemic barriers those individuals face. This complicates the statistic cited in the introduction about households with same-sex couples having a higher median income than households with opposite-sex couples. Even if the average American in a same-sex couple may make a higher income, that average obscures the variations in data that surface when we disaggregate by race. That average statistic exists because white people make up such a large percentage of the population, and white Americans in same-sex couples have a consistently higher representation in high income tiers when compared to white Americans in opposite-sex couples. By disaggregating the data, we are able to see that racial inequity of income for Americans is compounded when those Americans are from same-sex couples.

However, our findings have several important caveats, first and foremost of which is the fact that there is significantly less data on individuals from same-sex couples as compared to opposite-sex couples. This isn’t something that can be easily addressed, since queer people make up such a small percentage of the population. Additionally, it is important to qualify these conclusions with the understanding that personal income is not a perfect proxy for “success” or “well-being.” There may be many other factors that should be considered when examining the impact of race and gender on same-sex couples. 

Further analysis on this topic could look at outcome factors other than personal income in order to see how other metrics are impacted by race and couple status. In addition, an analysis that keeps couples together and has many categories for different combinations of interracial couples would be better suited for comparison with the statistic about median household income. Lastly, a study conducted some time in the future could yield more robust results as more same-sex couples are reported by the survey.


<br> 

<br>
